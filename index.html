<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inna´s Rezepte</title>
    <link rel="stylesheet" href="style.css?v=9">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Lora:ital,wght@0,400;0,500;1,400&display=swap"
        rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            alert("Fehler in Zeile " + lineNo + ":\n" + msg);
            return false;
        };
    </script>
</head>

<body>
    <header class="app-header">
        <div class="header-content">
            <div class="logo">
                <i class="fa-solid fa-seedling"></i>
                <h1 id="appHeaderTitle">Inna´s Rezepte</h1>
            </div>
            <div class="header-actions">
                <div class="search-actions">
                    <div class="search-bar">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="searchInput" placeholder="Rezepte durchsuchen...">
                    </div>
                    <button id="mobileFoldersBtn" class="icon-btn hide-on-desktop" title="Meine Ordner">
                        <i class="fa-regular fa-folder-open"></i>
                    </button>
                    <button id="mobileControlsBtn" class="icon-btn hide-on-desktop" title="Filter & Ansicht">
                        <i class="fa-solid fa-sliders"></i>
                    </button>
                    <button id="addRecipeBtn" class="primary-btn">
                        <i class="fa-solid fa-plus"></i> <span class="hide-on-mobile">Neues Rezept</span>
                    </button>
                </div>
                <div class="header-icons">
                    <button id="settingsBtn" class="icon-btn settings-btn" title="Einstellungen">
                        <i class="fa-solid fa-gear"></i>
                    </button>
                    <button id="logoutBtn" class="icon-btn logout-btn" title="Abmelden">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </button>
                </div>
            </div>
            <div id="mobileDropdownFolders" class="mobile-dropdown-content hidden"></div>
            <div id="mobileDropdownControls" class="mobile-dropdown-content hidden"></div>
        </div>
    </header>

    <main class="app-main main-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Meine Ordner</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="editFoldersBtn" class="edit-folder-btn" title="Ordner bearbeiten">
                        <i class="fa-solid fa-pencil"></i>
                    </button>
                    <button id="addFolderBtn" class="add-folder-btn" title="Neuer Ordner">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
            </div>
            <ul id="folderList" class="folder-list">
                <li class="folder-item active" data-folder-id="all">
                    <i class="fa-solid fa-layer-group"></i> <span>Alle Rezepte</span>
                </li>
                <!-- Dynamische Ordner kommen hier rein -->
            </ul>
        </aside>

        <div class="content-area" id="contentArea">
            <section class="controls" id="recipeControls">
                <div class="control-group">
                    <label for="categoryFilter" title="Kategorie filtern"><i class="fa-solid fa-tag"></i></label>
                    <select id="categoryFilter">
                        <option value="all">Alle Kategorien</option>
                        <!-- Dynamic options via JS -->
                    </select>
                </div>
                <div class="control-group">
                    <label for="sortSelect" title="Sortieren nach"><i
                            class="fa-solid fa-arrow-down-short-wide"></i></label>
                    <select id="sortSelect">
                        <option value="newest">Neueste zuerst</option>
                        <option value="manual">Eigene Reihenfolge</option>
                        <option value="oldest">Älteste zuerst</option>
                        <option value="az">A-Z</option>
                        <option value="za">Z-A</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="viewModeSelect" title="Ansicht ändern"><i
                            class="fa-solid fa-table-cells-large"></i></label>
                    <select id="viewModeSelect">
                        <option value="grid">Große Kacheln</option>
                        <option value="small-grid">Kleine Kacheln</option>
                        <option value="list">Liste</option>
                    </select>
                </div>
            </section>

            <section class="recipe-grid" id="recipeGrid">
                <!-- Recipe Cards will be injected here via JavaScript -->
            </section>

            <div id="emptyState" class="empty-state hidden">
                <i class="fa-solid fa-book-open"></i>
                <p>Dein Kochbuch ist noch leer. Füge ein neues Rezept hinzu!</p>
            </div>
        </div>
    </main>

    <!-- Modal for Adding/Editing Recipe -->
    <div id="recipeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Neues Rezept hinzufügen</h2>
                <button class="close-btn" id="closeModalBtn"><i class="fa-solid fa-times"></i></button>
            </div>
            <form id="recipeForm">
                <input type="hidden" id="recipeId">

                <div class="form-group">
                    <label for="recipeTitle">Titel</label>
                    <input type="text" id="recipeTitle" required placeholder="z.B. Ratatouille">
                </div>

                <div class="form-group">
                    <label for="recipeFolder">Ordner (optional)</label>
                    <select id="recipeFolder">
                        <option value="">Kein Ordner</option>
                        <!-- Dynamic Folders -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="recipeCategory">Kategorie</label>
                    <select id="recipeCategory" required>
                        <!-- Dynamic options via JS -->
                    </select>
                </div>

                <div class="form-group">
                    <label>Bilder (Optional)</label>
                    <div class="file-upload-container">
                        <label for="recipeImage" class="file-upload-btn">
                            <i class="fa-solid fa-camera"></i> Bilder auswählen
                        </label>
                        <input type="file" id="recipeImage" accept="image/*" multiple style="display: none;">
                    </div>
                    <!-- Moved Image Preview outside label for better multi-image grid support -->
                    <div id="imagePreview" class="image-preview-grid">
                        <span>Keine Bilder ausgewählt</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="recipeIngredients">Zutaten (Eine pro Zeile)</label>
                    <textarea id="recipeIngredients" rows="5" required
                        placeholder="- 2 Zucchini&#10;- 1 Aubergine&#10;- 3 Tomaten"></textarea>
                </div>

                <div class="form-group">
                    <label for="recipeInstructions">Zubereitung</label>
                    <textarea id="recipeInstructions" rows="6" required
                        placeholder="Das Gemüse in Scheiben schneiden..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="secondary-btn" id="cancelBtn">Abbrechen</button>
                    <button type="submit" class="primary-btn">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Viewing a Recipe -->
    <div id="viewModal" class="modal hidden">
        <div class="modal-content view-modal-content">
            <button class="close-btn" id="closeViewModalBtn"><i class="fa-solid fa-times"></i></button>
            <div id="viewRecipeDetails">
                <!-- Recipe details injected here -->
            </div>
            <div class="modal-actions" style="justify-content: space-between;">
                <button class="primary-btn" id="editRecipeBtn"><i class="fa-solid fa-pen"></i> Bearbeiten</button>
                <button class="danger-btn" id="deleteRecipeBtn"><i class="fa-solid fa-trash"></i> Löschen</button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Folder -->
    <div id="folderModal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Neuer Ordner</h2>
                <button class="close-btn" id="closeFolderModalBtn"><i class="fa-solid fa-times"></i></button>
            </div>
            <form id="folderForm">
                <div class="form-group">
                    <label for="folderName">Ordnername</label>
                    <input type="text" id="folderName" required placeholder="z.B. Lieblingskuchen">
                </div>
                <div class="modal-actions" style="margin-top: 2rem;">
                    <button type="button" class="secondary-btn" id="cancelFolderModalBtn">Abbrechen</button>
                    <button type="submit" class="primary-btn" id="saveFolderBtn">Erstellen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h2>Einstellungen</h2>
                <button class="close-btn" id="closeSettingsModalBtn"><i class="fa-solid fa-times"></i></button>
            </div>

            <div class="settings-tabs">
                <button class="tab-btn active" data-tab="profileTab">Profil</button>
                <button class="tab-btn" data-tab="categoriesTab">Kategorien</button>
            </div>

            <div class="tab-content active" id="profileTab">
                <h3>App Name ändern</h3>
                <form id="appNameForm" style="margin-bottom: 2rem;">
                    <div class="form-group">
                        <label for="appNameInput">Name (z.B. Mein Kochbuch)</label>
                        <input type="text" id="appNameInput" required>
                    </div>
                    <p id="appNameMessage" class="form-message hidden"></p>
                    <button type="submit" class="primary-btn" id="saveAppNameBtn">Name speichern</button>
                </form>

                <hr style="margin-bottom: 2rem; opacity: 0.2;">

                <h3>Passwort ändern</h3>
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="newPassword">Neues Passwort</label>
                        <input type="password" id="newPassword" required minlength="6"
                            placeholder="Mindestens 6 Zeichen">
                    </div>
                    <p id="passwordMessage" class="form-message hidden"></p>
                    <button type="submit" class="primary-btn" id="savePasswordBtn">Passwort speichern</button>
                </form>
            </div>

            <div class="tab-content" id="categoriesTab">
                <h3>Kategorien verwalten</h3>
                <form id="categoryForm" class="add-category-form">
                    <input type="text" id="newCategoryName" required placeholder="Neue Kategorie...">
                    <button type="submit" class="primary-btn"><i class="fa-solid fa-plus"></i> Hinzufügen</button>
                </form>
                <ul id="settingsCategoryList" class="settings-list">
                    <!-- Dynamic categories injected here -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="logo">
                <i class="fa-solid fa-seedling"></i>
                <h2 id="loginAppTitle">Inna´s Rezepte</h2>
            </div>

            <h2 id="authMainTitle" class="auth-main-title">Anmelden</h2>
            <p class="login-subtitle">Bitte melde dich an, um fortzufahren.</p>

            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">E-Mail</label>
                    <input type="email" id="loginEmail" required placeholder="deine@email.de">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Passwort</label>
                    <input type="password" id="loginPassword" required placeholder="••••••••">
                </div>
                <div id="loginError" class="login-error hidden">Fehler beim Anmelden.</div>
                <button type="submit" id="authSubmitBtn" class="primary-btn login-btn"
                    style="width: 100%; justify-content: center;">Anmelden</button>
                <div class="auth-toggle">
                    <span id="authToggleText">Noch kein Konto?</span>
                    <a href="#" id="authToggleLink">Jetzt registrieren</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Lightbox Modal for Image Gallery -->
    <div id="lightboxModal" class="lightbox hidden">
        <button class="lightbox-close" id="lightboxCloseBtn">&times;</button>
        <button class="lightbox-nav prev" id="lightboxPrevBtn">&#10094;</button>
        <img id="lightboxImage" src="" alt="Fullscreen view">
        <button class="lightbox-nav next" id="lightboxNextBtn">&#10095;</button>
        <div id="lightboxCounter" class="lightbox-counter">1 / 1</div>
    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js?v=7"></script>
</body>

</html>